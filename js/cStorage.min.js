/* cStorage 0.2.4 */
function cStorage(b,a){if(!b){throw new Error("missing function params");return false}else{this._dbname=b;this._data=_helper.getStorage(this._dbname);this._foundParent=this.root(a)._foundParent;this._foundChild=false;this._foundPath=false;this._foundKey=false;this._isFound=false;return this}}cStorage.prototype.save=function(b,a,c){if(!b||typeof b!=="object"){b=this._data}if(c==undefined){c=true}if(a){_helper.loop(b,function(d,e){return _helper.encode(d[e])},c)}this._data=this._foundParent=b;this._isFound=false;window.localStorage.setItem(this._dbname,this.toString());return this};cStorage.prototype.root=function(a){this._foundParent=this._data;this._foundKey=false;this._foundChild=false;this._foundPath=false;this._isFound=false;if(!a){this._foundParent=this._data}else{var b=_helper.getRootObjFromString(this._data,a);if(b){this._foundParent=b;this._foundPath=a.split(".");this._isFound=true}}return this};cStorage.prototype.find=function(g,f){if(!g){return false}if(f==undefined){f=true}var d,e;if(typeof g==="string"||typeof g==="number"){e=d=g}else{for(var c in g){d=c;e=g[c]}}var a=this._foundParent;this._foundParent=false;this._foundKey=false;this._foundChild=false;this._foundPath=false;this._isFound=false;var b=_helper.find(a,{key:d,value:e},f);if(b){this._foundParent=b[1];this._foundKey=b[2];this._foundChild=b[3];this._foundPath=b[4];this._isFound=true}return this};cStorage.prototype.get=function(a,c,d){var b=this._foundParent;if(a){b=_helper.getRootObjFromString(this._data,a)}if(c){if(d==undefined){d=true}_helper.loop(b,function(e,f){return _helper.decode(e[f])},d)}return b};cStorage.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))};cStorage.prototype.edit=function(c){if(Object.prototype.toString.call(this._foundParent)==="[object Array]"){return this}if(!c){return this}var b,b;for(var a in c){b=a||"";findValue=c[a]||"";if(b){this._foundParent[b]=findValue}}this.save();return this};cStorage.prototype.add=function(d){if(!d){return this}var a=this._foundParent;var c=this;var e=function(h,j){if(Object.prototype.toString.call(h)==="[object Object]"){var g,g;for(var f in j){g=f||"";findValue=j[f]||"";if(g){h[g]=findValue}}}else{if(Object.prototype.toString.call(h)==="[object Array]"){h.push(j)}}};if(Object.prototype.toString.call(d)==="[object Array]"){for(var b in d){e(a,d[b])}}else{e(a,d)}this.save();return this};cStorage.prototype.remove=function(){if(!this._foundPath&&this._foundParent){return false}var a=JSON.parse(JSON.stringify(this._foundPath));var b=a.pop();a=a.join(".");var c=_helper.getRootObjFromString(this._data,a);if(c){if(Object.prototype.toString.call(c)==="[object Array]"){c.splice(b,1);this.save()}else{if(Object.prototype.toString.call(c)==="[object Object]"){delete c[b];this.save()}}}else{return false}return this};cStorage.prototype.map=function(b,a){if(!b&&typeof b!=="function"){throw new Error("missing function params");return false}if(a==undefined){a=true}_helper.loop(this._foundParent,b,a);return this};cStorage.prototype.getValue=function(a){if(a){return _helper.decode(this._foundChild)}else{return this._foundChild}};cStorage.prototype.getUid=function(c,d){if(!c){throw new Error("missing function params");return false}var a=this._foundParent;if(d==undefined){d=true}var b=false;var f=function(g){if(!b){b=parseInt(g)}else{if(b<g){b=parseInt(g)}}};var e=function(g,h,i){if(c==h){f(i)}};_helper.loop(a,e,d);if(!b||isNaN(b)){b=0}return parseInt(b)+1};cStorage.prototype.toString=function(a,b,c){return JSON.stringify(this.get(a,b,c))};cStorage.prototype.isEmpty=function(){var a=this._foundParent;if(JSON.stringify(a).replace(/[{}\[\]]/g,"")==""){return true}else{return false}};cStorage.prototype.isFound=function(){return this._isFound};var _helper={getStorage:function(a){var b=window.localStorage.getItem(a)||"{}";var d={};try{d=JSON.parse(b);if(typeof d==="object"){return d}return{}}catch(c){throw new Error("non well formed json string");return{}}},encode:function(a){if(a&&typeof a==="string"){return encodeURIComponent(a)}return a},decode:function(a){if(a&&typeof a==="string"){return decodeURIComponent(a.replace(/\+/g," "))}return a},getRootObjFromString:function(c,a){if(!c){return false}var d=c;if(a){a=a.split(".");for(var b in a){d=d[a[b]]}}return d},find:function(g,a,h,e){var d;if(Object.prototype.toString.call(g)==="[object Object]"){d="object"}else{if(Object.prototype.toString.call(g)==="[object Array]"){d="array"}else{return false}}var f=e||[];for(var b in g){if(g.hasOwnProperty(b)){if(d=="object"){if(a.key&&a.value&&b==a.key&&g[b]==a.value){return[true,g,b,g[b],f]}}else{if(d=="array"){if(a.value&&g[b]==a.value){return[true,g,b,g[b],f]}}}if(typeof g[b]==="object"&&h){var c=_helper.find(g[b],a,h,f);if(c&&c[0]){f.unshift(b);return[true,c[1],c[2],c[3],c[4]]}}}}},loop:function(a,f,e){var d;if(Object.prototype.toString.call(a)==="[object Object]"){d="object"}else{if(Object.prototype.toString.call(a)==="[object Array]"){d="array"}else{return false}}for(var c in a){if(a.hasOwnProperty(c)){if(f){var b=f(a,c,a[c]);if(b){a[c]=b}}if(typeof a[c]==="object"&&e){_helper.loop(a[c],f,e)}}}return false}};
